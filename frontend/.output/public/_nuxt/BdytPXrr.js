import{V as Ee,a as ne,u as Oe,b as ie,c as ce,d as fe,e as Be}from"./-qS-kRan.js";import{J as xe,s as O,k as A,K as x,L as Ne,M as ue,N as Ue,z as D,O as W,P as J,Q as $e,R as je,r as P,S as le,T as U,B as m,U as N,V as ze,W as de,X as ve,Y as Qe,Z as me,$ as He,a0 as We,a1 as Je,a2 as Xe,D as X,o as Ye,a3 as he,C as E,y as H,x as ge,a4 as te,a5 as Ze,A as ye}from"./B_9B--Gh.js";import{u as Ge,a as qe,b as el,V as Ve,f as ll,m as tl,c as al,d as nl,e as ul,g as ke,h as ol,i as rl}from"./COzGDrdo.js";import{u as sl,a as il,m as cl,V as pe,b as fl,c as dl}from"./C9JAJKl2.js";import{V as vl}from"./BR29G1Jp.js";import"./CypGsUf9.js";const ml=(e,o,t)=>{if(e==null||o==null)return-1;if(!o.length)return 0;e=e.toString().toLocaleLowerCase(),o=o.toString().toLocaleLowerCase();const c=[];let a=e.indexOf(o);for(;~a;)c.push([a,a+o.length]),a=e.indexOf(o,a+o.length);return c.length?c:-1};function ae(e,o){if(!(e==null||typeof e=="boolean"||e===-1))return typeof e=="number"?[[e,e+o.length]]:Array.isArray(e[0])?e:[e]}const hl=xe({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function gl(e,o,t){var _;const c=[],a=(t==null?void 0:t.default)??ml,f=t!=null&&t.filterKeys?ue(t.filterKeys):!1,v=Object.keys((t==null?void 0:t.customKeyFilter)??{}).length;if(!(e!=null&&e.length))return c;e:for(let b=0;b<e.length;b++){const[C,s=C]=ue(e[b]),I={},d={};let i=-1;if((o||v>0)&&!(t!=null&&t.noFilter)){if(typeof C=="object"){const y=f||Object.keys(s);for(const n of y){const $=Ue(s,n),R=(_=t==null?void 0:t.customKeyFilter)==null?void 0:_[n];if(i=R?R($,o,C):a($,o,C),i!==-1&&i!==!1)R?I[n]=ae(i,o):d[n]=ae(i,o);else if((t==null?void 0:t.filterMode)==="every")continue e}}else i=a(C,o,C),i!==-1&&i!==!1&&(d.title=ae(i,o));const S=Object.keys(d).length,K=Object.keys(I).length;if(!S&&!K||(t==null?void 0:t.filterMode)==="union"&&K!==v&&!S||(t==null?void 0:t.filterMode)==="intersection"&&(K!==v||!S))continue}c.push({index:b,matches:{...d,...I}})}return c}function yl(e,o,t,c){const a=O([]),f=O(new Map),v=A(()=>x(o));Ne(()=>{const b=typeof t=="function"?t():x(t),C=typeof b!="string"&&typeof b!="number"?"":String(b),s=gl(v.value,C,{customKeyFilter:{...e.customKeyFilter,...x(c==null?void 0:c.customKeyFilter)},default:e.customFilter,filterKeys:e.filterKeys,filterMode:e.filterMode,noFilter:e.noFilter}),I=x(o),d=[],i=new Map;s.forEach(S=>{let{index:K,matches:y}=S;const n=I[K];d.push(n),i.set(n.value,y)}),a.value=d,f.value=i});function _(b){return f.value.get(b.value)}return{filteredItems:a,filteredMatches:f,getMatches:_}}function Vl(e,o,t){return t==null||!t.length?o:t.map((c,a)=>{const f=a===0?0:t[a-1][1],v=[D("span",{class:W(`${e}__unmask`)},[o.slice(f,c[0])]),D("span",{class:W(`${e}__mask`)},[o.slice(c[0],c[1])])];return a===t.length-1&&v.push(D("span",{class:W(`${e}__unmask`)},[o.slice(c[1])])),D(J,null,[v])})}const kl=xe({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:Boolean,search:String,...hl({filterKeys:["title"]}),...tl(),...ze(al({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...cl({transition:!1})},"VAutocomplete"),pl=$e()({name:"VAutocomplete",props:kl(),emits:{"update:focused":e=>!0,"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,o){let{slots:t}=o;const{t:c}=je(),a=P(),f=O(!1),v=O(!0),_=O(!1),b=P(),C=P(),s=O(-1),{items:I,transformIn:d,transformOut:i}=Ge(e),{textColorClasses:S,textColorStyles:K}=sl(()=>{var l;return(l=a.value)==null?void 0:l.color}),y=le(e,"search",""),n=le(e,"modelValue",[],l=>d(l===null?[null]:ue(l)),l=>{const u=i(l);return e.multiple?u:u[0]??null}),$=A(()=>typeof e.counterValue=="function"?e.counterValue(n.value):typeof e.counterValue=="number"?e.counterValue:n.value.length),R=qe(e),{filteredItems:Y,getMatches:Fe}=yl(e,I,()=>v.value?"":y.value),L=A(()=>e.hideSelected?Y.value.filter(l=>!n.value.some(u=>u.value===l.value)):Y.value),j=A(()=>!!(e.chips||t.chip)),B=A(()=>j.value||!!t.selection),be=A(()=>n.value.map(l=>l.props.value)),Z=A(()=>{var u;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&y.value===((u=L.value[0])==null?void 0:u.title))&&L.value.length>0&&!v.value&&!_.value}),z=A(()=>e.hideNoData&&!L.value.length||R.isReadonly.value||R.isDisabled.value),G=le(e,"menu"),k=A({get:()=>G.value,set:l=>{var u;G.value&&!l&&((u=b.value)!=null&&u.Î¨openChildren.size)||l&&z.value||(G.value=l)}}),oe=A(()=>k.value?e.closeText:e.openText),q=P(),Ce=el(q,a);function we(l){e.openOnClear&&(k.value=!0),y.value=""}function Se(){z.value||(k.value=!0)}function _e(l){z.value||(f.value&&(l.preventDefault(),l.stopPropagation()),k.value=!k.value)}function Ie(l){var u;l.key!==" "&&de(l)&&((u=a.value)==null||u.focus())}function Me(l){var r,V,w,M,h;if(R.isReadonly.value)return;const u=(r=a.value)==null?void 0:r.selectionStart,g=n.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(l.key)&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(k.value=!0),["Escape"].includes(l.key)&&(k.value=!1),Z.value&&["Enter","Tab"].includes(l.key)&&!n.value.some(F=>{let{value:p}=F;return p===L.value[0].value})&&T(L.value[0]),l.key==="ArrowDown"&&Z.value&&((V=q.value)==null||V.focus("next")),["Backspace","Delete"].includes(l.key)){if(!e.multiple&&B.value&&n.value.length>0&&!y.value)return T(n.value[0],!1);if(~s.value){l.preventDefault();const F=s.value;T(n.value[s.value],!1),s.value=F>=g-1?g-2:F}else l.key==="Backspace"&&!y.value&&(s.value=g-1);return}if(e.multiple)if(l.key==="ArrowLeft"){if(s.value<0&&u&&u>0)return;const F=s.value>-1?s.value-1:g-1;if(n.value[F])s.value=F;else{const p=((w=y.value)==null?void 0:w.length)??null;s.value=-1,(M=a.value)==null||M.setSelectionRange(p,p)}}else if(l.key==="ArrowRight"){if(s.value<0)return;const F=s.value+1;n.value[F]?s.value=F:(s.value=-1,(h=a.value)==null||h.setSelectionRange(0,0))}else~s.value&&de(l)&&(s.value=-1)}function Ae(l){if(ve(a.value,":autofill")||ve(a.value,":-webkit-autofill")){const u=I.value.find(g=>g.title===l.target.value);u&&T(u)}}function De(){var l;e.eager&&((l=C.value)==null||l.calculateVisibleItems())}function Pe(){var l;f.value&&(v.value=!0,(l=a.value)==null||l.focus())}function Ke(l){f.value=!0,setTimeout(()=>{_.value=!0})}function Le(l){_.value=!1}function Re(l){(l==null||l===""&&!e.multiple&&!B.value)&&(n.value=[])}const ee=O(!1);function T(l){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!l||l.props.disabled))if(e.multiple){const g=n.value.findIndex(V=>(e.valueComparator||Qe)(V.value,l.value)),r=u??!~g;if(~g){const V=r?[...n.value,l]:[...n.value];V.splice(g,1),n.value=V}else r&&(n.value=[...n.value,l]);e.clearOnSelect&&(y.value="")}else{const g=u!==!1;n.value=g?[l]:[],y.value=g&&!B.value?l.title:"",me(()=>{k.value=!1,v.value=!0})}}return U(f,(l,u)=>{var g;l!==u&&(l?(ee.value=!0,y.value=e.multiple||B.value?"":String(((g=n.value.at(-1))==null?void 0:g.props.title)??""),v.value=!0,me(()=>ee.value=!1)):(!e.multiple&&y.value==null&&(n.value=[]),k.value=!1,(e.multiple||B.value)&&(y.value=""),s.value=-1))}),U(y,l=>{!f.value||ee.value||(l&&(k.value=!0),v.value=!l)}),U(k,()=>{if(!e.hideSelected&&k.value&&n.value.length){const l=L.value.findIndex(u=>n.value.some(g=>u.value===g.value));He&&window.requestAnimationFrame(()=>{var u;l>=0&&((u=C.value)==null||u.scrollToIndex(l))})}}),U(()=>e.items,(l,u)=>{k.value||f.value&&!u.length&&l.length&&(k.value=!0)}),il(()=>{const l=!!(!e.hideNoData||L.value.length||t["prepend-item"]||t["append-item"]||t["no-data"]),u=n.value.length>0,g=Ve.filterProps(e);return m(Ve,N({ref:a},g,{modelValue:y.value,"onUpdate:modelValue":[r=>y.value=r,Re],focused:f.value,"onUpdate:focused":r=>f.value=r,validationValue:n.externalValue,counterValue:$.value,dirty:u,onChange:Ae,class:["v-autocomplete",`v-autocomplete--${e.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":k.value,"v-autocomplete--chips":!!e.chips,"v-autocomplete--selection-slot":!!B.value,"v-autocomplete--selecting-index":s.value>-1},e.class],style:e.style,readonly:R.isReadonly.value,placeholder:u?void 0:e.placeholder,"onClick:clear":we,"onMousedown:control":Se,onKeydown:Me}),{...t,default:()=>D(J,null,[m(nl,N({ref:b,modelValue:k.value,"onUpdate:modelValue":r=>k.value=r,activator:"parent",contentClass:"v-autocomplete__content",disabled:z.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterEnter:De,onAfterLeave:Pe},e.menuProps),{default:()=>[l&&m(ul,N({ref:q,selected:be.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:r=>r.preventDefault(),onKeydown:Ie,onFocusin:Ke,onFocusout:Le,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},Ce,e.listProps),{default:()=>{var r,V,w;return[(r=t["prepend-item"])==null?void 0:r.call(t),!L.value.length&&!e.hideNoData&&(((V=t["no-data"])==null?void 0:V.call(t))??m(ke,{key:"no-data",title:c(e.noDataText)},null)),m(ol,{ref:C,renderless:!0,items:L.value,itemKey:"value"},{default:M=>{var se;let{item:h,index:F,itemRef:p}=M;const re=N(h.props,{ref:p,key:h.value,active:Z.value&&F===0?!0:void 0,onClick:()=>T(h,null)});return((se=t.item)==null?void 0:se.call(t,{item:h,index:F,props:re}))??m(ke,N(re,{role:"option"}),{prepend:Q=>{let{isSelected:Te}=Q;return D(J,null,[e.multiple&&!e.hideSelected?m(rl,{key:h.value,modelValue:Te,ripple:!1,tabindex:"-1"},null):void 0,h.props.prependAvatar&&m(Ee,{image:h.props.prependAvatar},null),h.props.prependIcon&&m(pe,{icon:h.props.prependIcon},null)])},title:()=>{var Q;return v.value?h.title:Vl("v-autocomplete",h.title,(Q=Fe(h))==null?void 0:Q.title)}})}}),(w=t["append-item"])==null?void 0:w.call(t)]}})]}),n.value.map((r,V)=>{function w(p){p.stopPropagation(),p.preventDefault(),T(r,!1)}const M={"onClick:close":w,onKeydown(p){p.key!=="Enter"&&p.key!==" "||(p.preventDefault(),p.stopPropagation(),w(p))},onMousedown(p){p.preventDefault(),p.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},h=j.value?!!t.chip:!!t.selection,F=h?Je(j.value?t.chip({item:r,index:V,props:M}):t.selection({item:r,index:V})):void 0;if(!(h&&!F))return D("div",{key:r.value,class:W(["v-autocomplete__selection",V===s.value&&["v-autocomplete__selection--selected",S.value]]),style:Xe(V===s.value?K.value:{})},[j.value?t.chip?m(fl,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:r.title}}},{default:()=>[F]}):m(ne,N({key:"chip",closable:e.closableChips,size:"small",text:r.title,disabled:r.props.disabled},M),null):F??D("span",{class:"v-autocomplete__selection-text"},[r.title,e.multiple&&V<n.value.length-1&&D("span",{class:"v-autocomplete__selection-comma"},[X(",")])])])})]),"append-inner":function(){var M,h;for(var r=arguments.length,V=new Array(r),w=0;w<r;w++)V[w]=arguments[w];return D(J,null,[(M=t["append-inner"])==null?void 0:M.call(t,...V),e.menuIcon?m(pe,{class:"v-autocomplete__menu-icon",color:(h=a.value)==null?void 0:h.fieldIconColor,icon:e.menuIcon,onMousedown:_e,onClick:We,"aria-label":c(oe.value),title:c(oe.value),tabindex:"-1"},null):void 0])}})}),ll({isFocused:f,isPristine:v,menu:k,search:y,filteredItems:Y,select:T},a)}}),xl={key:0,class:"mt-4"},Fl={key:1,class:"mt-4"},Ml={__name:"index",setup(e){const{foods:o}=Oe(),t=P([]),c=P(null),a=P(null),f=P(!1),v=P(""),_=P([{value:"free",label:"Freely"},{value:"moderate",label:"In moderation"},{value:"rarely",label:"Rarely"},{value:"never",label:"Never"}]),b=d=>{switch(d){case"free":return"success";case"moderate":return"warning";case"rarely":return"deep-orange";case"never":return"error";default:return"grey"}},C=(d,i)=>{const S=d.find(K=>K.value===i);return S?S.label:"Unknown"};Ye(async()=>{await s()}),U(c,async d=>{d?await I(d):a.value=null});const s=async()=>{try{f.value=!0,v.value="";const d=await o.getAll();t.value=d.foods||[]}catch(d){v.value=`Failed to fetch foods: ${d.message}`,console.error("Error fetching foods:",d)}finally{f.value=!1}},I=async d=>{f.value=!0;try{const i=await o.getById(d);a.value=i.food}catch(i){v.value=`Failed to fetch food details: ${i.message}`,console.error("Error fetching food details:",i)}finally{f.value=!1}};return(d,i)=>(H(),he(ie,{style:{}},{default:E(()=>[m(ce,{class:"text-h5"},{default:E(()=>i[1]||(i[1]=[X(" Can they eat it? ")])),_:1,__:[1]}),m(fe,null,{default:E(()=>[m(pl,{modelValue:x(c),"onUpdate:modelValue":i[0]||(i[0]=S=>Ze(c)?c.value=S:null),label:"Type to search",placeholder:"Search for food",clearable:"","hide-details":"",variant:"solo-filled",items:x(t),"item-title":"name","item-value":"id",loading:x(f)},null,8,["modelValue","items","loading"]),x(a)?(H(),ge("div",xl,[x(f)?(H(),he(dl,{key:0,indeterminate:"",color:"primary",class:"mb-2"})):te("",!0),m(ie,null,{default:E(()=>[m(ce,{class:"text-h6"},{default:E(()=>[X(ye(x(a).name),1)]),_:1}),m(fe,null,{default:E(()=>[X(ye(x(a).description),1)]),_:1}),m(Be,null,{default:E(()=>[m(ne,{color:x(a).can_eat?"success":"error",text:x(a).can_eat?"Safe to eat":"Not recommended"},null,8,["color","text"]),m(ne,{color:b(x(a).quantity),text:C(x(_),x(a).quantity)},null,8,["color","text"])]),_:1})]),_:1})])):te("",!0),x(v)?(H(),ge("div",Fl,[m(vl,{type:"error",text:x(v)},null,8,["text"])])):te("",!0)]),_:1})]),_:1}))}};export{Ml as default};
